# Replace the $ZAP_TEST_URL with our test HTTP server
expand src.http

# Run the equivalent of zap run src.http --request getItem
exec run-request src.http getItem

# Replace anything that looks like a small time duration with a placeholder
# 30s
# 15.32s
# 103.5656ms
replace stdout '\d+(?:\.\d+)?(?:s|ms|µs)' '[DURATION]'

# Fail if stdout != expected and show a diff
cmp stdout expected

# There should be nothing printed to stderr
! stderr .

-- src.http --
###
# @name = getItem
GET $ZAP_TEST_URL/ok

### IgnoreMe
# @name = another
GET $ZAP_TEST_URL/bad-request
-- expected --

src.http: getItem
────────────────────────────────────────────────────────────────────────────────

HTTP/1.1 200 OK ([DURATION])

{"stuff": "here"}
